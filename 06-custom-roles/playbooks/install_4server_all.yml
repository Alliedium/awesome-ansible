- hosts: manjaros
  gather_facts: yes
  become: yes
  tasks:
  - name: Edit sudoers
    community.general.sudoers:
      name: wheel-nopasswd
      group: wheel
      commands: ALL
      nopassword: true
      state: present
      validation: required

  - name: Remove snap
    include_role:
      name: bodsch.snapd

  - name: Gather the package facts
    package_facts:
      manager: auto

  - name: Update all via yay or pacman if yay is not installed
    include_role:
      name: update-all-via-pacman-or-yay

  - name: Install git for building yay from binaries
    pacman:
      name: git
      state: present
    when: ('yay' not in ansible_facts.packages) and (ansible_facts['kernel'] is not search("MANJARO"))

  - name: Enable AURs
    include_role:
      name: enable-aurs